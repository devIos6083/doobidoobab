# 🎨 DoobiDoobab

## 📌 목차  
- [프로젝트 요약](#📌-프로젝트-요약)  
- [진행 상황](#📅-진행-상황)  
- [구현 결과](#🖥-구현-결과)  
- [트러블 슈팅](#🛠-트러블-슈팅)  
- [학습한 내용](#📚-학습한-내용)  
- [느낀 점](#💬-느낀-점)  
- [향후 계획](#📌-향후-계획)

---


## 📌 프로젝트 요약  

| 항목              | 상세 내용 |
|-----------------|--------------------------------------------------------------|
| **기여도**       | **100% (1인 개발)** |
| **프로젝트 목적** | 그림을 통해 매일 영단어 학습을 도와주기 |
| **구현 기간**    | **2024.04.02 ~ 진행중 ** |
| **기술 스택**    | **Flutter / Dart / Firebase / TensorFlow Lite / Flask / Python ** |
| **핵심 기능**    | 단어 학습 게임, 그림 그리기, 데이터 동기화, 그림 인식 AI, 네컷 스토리 생성 |

---
## 📌 진행 상황

| 날짜 | 작업 내용 |
|------|----------|
| **2025. 4. 2** | 프로젝트 초기화 및 환경 세팅, 사용자 정보 관리 서비스 구현 |
| **2025. 4. 5** | 메인 화면 및 출석 체크 시스템 구현, 그림 그리기 기능 개발 및 최적화 |
| **2025. 4. 10** | **오늘의 게임 구현**: 여러 게임을 랜덤하게 배치하여 진행<br>- 단어 학습 게임 로직 구현<br>- 각 게임의 UI 구성 및 애니메이션 적용<br>- 단어 연결 게임을 수동 연결 방식으로 전환<br>- 코드 분량이 많아져 리펙토링의 필요성을 절감<br>- 그린 그림 저장 기능과 단어 연결 정답 판별 로직은 미해결 상태 |
| **2025. 4. 13** | - **알림 기능 구현**: 앱이 백그라운드 상태일 때 학습 알림 전송<br>- **MVVM 아키텍처 패턴으로 전면 리팩토링**<br>- **그림 저장 기능**: 사용자가 그린 5개 그림을 로컬 저장<br>- **통계 표시 기능**: 총 15개 단어 중 정답 개수 표시<br>- **단어 연결 게임 버그 해결**: 다음 단계 진행 문제 수정 |
| **2025. 4. 28** | - **Firebase Realtime Database로 백엔드 전환**<br>- **데이터 구조화 및 안전성 강화**<br>- **데이터 마이그레이션 도구 개발**<br>- **오프라인 지원 기능 추가**<br>- **멀티 디바이스 동기화 지원** |
| **2025. 5. 7** | - **그림 인식 AI 모델 통합 시작**<br>- **Flask 백엔드 서버 구축**<br>- **클라이언트-서버 통신 프로토콜 설계**<br>- **이미지 전처리 파이프라인 구현**<br>- **ngrok을 활용한 개발 환경 구축**<br>- **임시 평가 알고리즘 구현** |
| **2025. 5. 17** | - **네컷 스토리 생성 기능 개발**<br>- **그림 인식률 향상을 위한 UI 개선**: 선 굵기 최적화<br>- **FastAPI 서버 연동 문제 해결**: 422 오류 수정<br>- **로딩 중 미니 퀴즈 기능 개발**<br>- **학습 완료 화면 개선**: 완료 화면 통합<br>- **스토리 결과 화면 구현**: 페이지 네비게이션 UI 개발 |
---

## 📌 트러블 슈팅

### 🔹 문제 1: 그림 그리기 시 선이 자연스럽게 그려지지 않는 문제
- **원인:** 단순 선 연결 방식 사용, Paint 스타일 명시 부족
- **해결:** 베지어 곡선(Bezier curve) 알고리즘 적용, Paint의 스타일을 `stroke`로 명시하여 자연스러운 선 구현

### 🔹 문제 2: 사용자 연속 출석 기록 저장 문제
- **원인:** 날짜 비교 로직의 불완전성
- **해결:** ISO 8601 형식의 날짜 저장 및 `_daysBetween` 함수 구현으로 정확한 출석일 계산 로직 개선

### 🔹 문제 3: 데이터베이스 마이그레이션 이슈
- **원인:** 스키마 변경으로 인한 기존 데이터 손실 위험
- **해결:** 안전한 마이그레이션 로직 및 트랜잭션 처리 구현으로 데이터 무결성 보장

### 🔹 문제 4: 오늘의 게임 구현 관련 미해결 사항
- **게임 순서 랜덤 배치:** 게임들이 랜덤으로 나타나게 하는 로직이 복잡해져서 코드가 길어지고, 리펙토링이 어려워졌음  
- **코드 분량:** 다양한 게임 기능(이미지 매칭, 뜻 매칭, 단어 연결, 그림 그리기)을 한 화면에 통합하면서 코드가 지나치게 길어져 유지보수 및 리펙토링이 어려워짐  
- **그림 저장 기능:** 사용자가 그린 그림을 저장하는 기능은 아직 구현하지 못했으며, 기능 확장이 시급함  
- **단어 연결 게임 판별:** 단어 연결 기능은 구현되었지만, 연결한 결과가 올바른지 판별하는 로직이 미완성 상태로, 빠른 시일 내에 해결해야 함

### 🔹 문제 5: 오늘의 단어 학습을 하지 않은 채 앱을 종료할 경우 학습 유도 부족
- **원인:** 백그라운드 전환 시 학습 여부 체크 로직 미구현
- **해결:** `WidgetsBindingObserver`를 활용하여 앱 상태 변화를 감지하고, 오늘의 학습이 완료되지 않았을 경우 알림 전송

### 🔹 문제 6: MVVM 구조로의 전환 과정에서 데이터 흐름 혼선
- **원인:** 기존 코드가 UI와 로직이 섞여 있어 구조 분리가 어려웠음
- **해결:** ViewModel을 통한 상태 관리 도입, Repository를 통해 데이터 접근 계층 분리

### 🔹 문제 7: 단어 그림 결과 저장 기능 누락
- **원인:** 그림 데이터를 로컬에 저장하는 로직 미비
- **해결:** `path_provider`와 `dart:io`를 활용하여 그림 파일을 로컬에 저장 후 결과 화면에서 로드하여 표시

### 🔹 문제 8: 단어 연결 게임 완료 후 다음 게임으로 넘어가지 않음
- **원인:** 연결 완료 상태를 감지하는 트리거가 누락됨
- **해결:** 연결 완료 후 상태를 감지하여 다음 스테이지로 전환하는 로직 추가

### 🔹 문제 9: Firebase 데이터 동기화 시 오프라인 모드 지원 문제
- **원인:** 인터넷 연결이 불안정할 때 데이터 동기화 및 앱 사용성 저하
- **해결:** Firebase의 오프라인 퍼시스턴스 활성화 및 로컬 캐싱 전략 도입으로 오프라인 환경에서도 앱 사용 가능

### 🔹 문제 10: Flutter와 Flask 서버 간 통신 문제
- **원인:** 크로스 플랫폼 통신 과정에서의 CORS 정책 제한 및 타임아웃 발생
- **해결:** 
  1. Flask 서버에 CORS 지원 추가 (`flask-cors` 패키지 사용)
  2. 타임아웃 시간 조정 및 예외 처리 향상
  3. ngrok을 통한 안정적인 터널링 구축으로 로컬-클라우드 통신 최적화

### 🔹 문제 11: 그림 인식을 위한 이미지 전처리 이슈
- **원인:** Flutter에서 생성된 이미지 형식이 ML 모델에 적합하지 않음
- **해결:** 
  1. 이미지 크기, 형식, 채널 최적화 알고리즘 구현
  2. OpenCV와 NumPy를 활용한 이미지 정규화 및 노이즈 제거 파이프라인 구축
  3. 데이터 전송 시 이미지 압축 및 효율적인 인코딩 방식 적용

### 🔹 문제 12: 개발 환경과 프로덕션 환경 간 일관성 유지 문제
- **원인:** 로컬 개발 환경과 실제 배포 환경 간의 설정 차이로 인한 불일치
- **해결:** 
  1. 환경 변수 기반 설정 시스템 도입
  2. 개발/테스트/프로덕션 모드 분리 및 플래그 시스템 구현
  3. CI/CD 파이프라인을 위한 기반 코드 작성 및 테스트 자동화 준비

### 🔹 문제 13: FastAPI 서버 연동 시 422 오류 발생
- **원인:** 클라이언트(앱)에서 전송하는 요청 필드명과 서버에서 기대하는 필드명 사이에 불일치
- **해결:** 
  1. API 요청 형식 변경 (필드명을 'word'에서 'text'로 수정)
  2. 오류 로깅 및 디버깅 강화
  3. 요청 헤더에 'ngrok-skip-browser-warning' 추가로 경고 페이지 우회

### 🔹 문제 14: 그림 인식률 저하 문제
- **원인:** 사용자가 그리는 선의 굵기가 일정하지 않아 AI 모델의 인식률 영향
- **해결:** 
  1. 그림 그리기 시 선 굵기를 최대값(20.0)으로 고정
  2. UI에서 굵기 조절 슬라이더 제거 및 안내 텍스트로 대체
  3. 일관된 굵기로 인식률 향상 및 사용자 경험 단순화

---

## 📌 구현 결과

### 앱 주요 화면

|   알람 기능 & 로그인 & 로그아웃 화면       |  오늘의 단어 학습 - 1 |   오늘의 단어 학습 - 2 |   놀이방 - 그리기 게임  |
|:---------------------------------------------:|:---------------------------------------------:|:---------------------------------------------:|:---------------------------------------------:|
| ![앱 화면 예시](https://github.com/user-attachments/assets/f3930d3d-22ef-4738-bda3-c37eb411672c) | ![앱 화면 예시](https://github.com/user-attachments/assets/154a19cd-d745-40ae-ba36-ba49dcf927ae) | ![앱 화면 예시](https://github.com/user-attachments/assets/23dd5ade-51ec-4196-a09d-70b67ede4753) | ![앱 화면 예시](https://github.com/user-attachments/assets/60aa2307-eef0-4f18-bd3e-58a24db1147e) |

### 네컷 스토리 생성 기능

|   단어 학습 완료 화면       |  스토리 생성 중 (로딩) |   생성된 스토리 결과  |
|:---------------------------------------------:|:---------------------------------------------:|:---------------------------------------------:|
| ![네컷 스토리 1](https://via.placeholder.com/400x800) | ![네컷 스토리 2](https://via.placeholder.com/400x800) | ![네컷 스토리 3](https://via.placeholder.com/400x800) |

### 그림 인식 AI 시스템 아키텍처

Flutter 앱 <----> ngrok 터널 <----> Flask 서버 <----> 이미지 전처리 <----> ML 모델


### 그림 인식 서비스 흐름도

1. **사용자 그림 생성**: 사용자가 Flutter 앱에서 그림을 그림
2. **이미지 변환**: 그림을 PNG 형식으로 변환 및 메타데이터 첨부
3. **서버 전송**: 이미지와 단어 정보를 Flask 서버로 전송
4. **이미지 전처리**: 
   - 크기 조정 (28x28 픽셀)
   - 그레이스케일 변환
   - 이진화 처리
   - 노이즈 제거
   - 정규화 (0-1 범위)
5. **모델 추론**: 전처리된 이미지를 ML 모델에 입력하여 추론 수행
6. **결과 반환**: 추론 결과를 JSON 형식으로 앱에 반환
7. **피드백 제공**: 결과에 기반하여 사용자에게 시각적 피드백 제공

### 네컷 스토리 생성 서비스 흐름도

1. **단어 학습 완료**: 사용자가 단어 학습 퀴즈를 완료
2. **스토리 생성 시작**: 학습한 단어와 그림을 선택하여 스토리 생성 요청
3. **API 요청**: 선택된 단어와 메타데이터를 FastAPI 서버로 전송
4. **스토리 생성**: AI가 4컷짜리 스토리 텍스트를 생성
5. **이미지 생성**: 생성된 스토리와 사용자의 그림을 기반으로 4개의 이미지 생성
6. **결과 표시**: 생성된 스토리와 이미지를 페이지 네비게이션 UI로 표시
7. **사용자 참여**: 로딩 중에 미니 퀴즈로 사용자 참여 유지

---

## 📌 학습한 내용

### ✅ 1. 컴퓨터 그래픽스 개념 적용
- 베지어 곡선을 이용한 자연스러운 그림 그리기 구현
- CustomPainter를 활용한 효율적인 Canvas 그리기 기법 습득

### ✅ 2. 상태 관리 및 생명주기 이해
- StatefulWidget의 생명주기와 setState를 통한 UI 업데이트 최적화
- 애니메이션 컨트롤러 사용으로 동적인 UI 구현 경험

### ✅ 3. 데이터 지속성 구현
- sqflite를 이용한 로컬 데이터베이스 설계 및 구현
- 싱글톤 패턴을 활용한 데이터베이스 서비스 구조화
- **Firebase Realtime Database를 통한 클라우드 데이터 관리 방법 습득**
- **NoSQL 데이터베이스 설계 패턴과 데이터 모델링 방법 학습**
- **오프라인 퍼시스턴스 및 데이터 동기화 메커니즘 이해**

### ✅ 4. 다양한 애니메이션 효과 적용
- 연속 출석, 컨페티 효과 등 다양한 애니메이션을 통해 사용자 경험 향상
- 애니메이션과 UI 요소의 통합 방법 학습

### ✅ 5. 코드 모듈화 및 재사용성 향상
- 기능별 파일 분리와 컴포넌트 설계로 유지보수성 및 확장성 향상
- 여러 게임 기능을 통합하는 과정에서의 코드 구조화 노하우 습득

### ✅ 6. 클라우드 데이터 관리 및 보안
- **Firebase 인증 기능과 보안 규칙 설정 방법 학습**
- **데이터베이스 트랜잭션 처리 및 일관성 유지 기법 이해**
- **사용자 데이터 암호화 및 보안 관련 모범 사례 적용**

### ✅ 7. 머신러닝 모델 통합 및 서버 구축
- **Flask 기반 백엔드 서버 아키텍처 설계 및 구현**
- **RESTful API 설계 원칙과 HTTP 통신 프로토콜 이해**
- **이미지 처리 파이프라인 구축 및 OpenCV 활용 기법 습득**
- **ngrok을 활용한 로컬 개발 환경의 공개 URL 터널링 솔루션 적용**
- **크로스 오리진 리소스 공유(CORS) 문제 해결 방법 습득**

### ✅ 8. 멀티플랫폼 개발 환경 구축
- **Flutter(Dart)와 Python 간 효율적인 데이터 교환 방법 습득**
- **Dio 패키지를 활용한 고급 HTTP 클라이언트 활용 기법 학습**
- **플랫폼별 최적화 및 에러 처리 전략 개발**
- **개발-테스트-배포 환경 분리 및 설정 관리 방법론 이해**

### ✅ 9. API 통신 오류 처리 및 디버깅
- **HTTP 상태 코드 분석을 통한 오류 원인 파악 방법 학습**
- **API 요청/응답 로깅 및 디버깅 기법 습득**
- **예외 처리 패턴 적용 및 사용자 친화적 오류 메시지 설계**
- **네트워크 타임아웃 설정 및 재시도 메커니즘 구현**

### ✅ 10. 사용자 경험 최적화
- **로딩 시간 동안 사용자 참여를 유지하는 기법 적용 (미니 퀴즈)**
- **그림 인식률 향상을 위한 UI 최적화 방법 이해**
- **페이지 네비게이션 구현으로 복잡한 콘텐츠 탐색 경험 개선**
- **사용자 피드백을 반영한 인터랙션 디자인 개선**

---

## 📌 느낀 점

- **사용자 동기부여의 중요성:** 단순히 게임을 제공하는 것이 아니라, 학습을 유도할 수 있는 장치(예: 알림)를 마련하는 것이 효과적임을 느낌  
- **구조화된 개발의 필요성:** MVVM으로 구조를 재설계하면서 확실히 유지보수 및 테스트가 수월해졌고, 향후 확장성에도 유리함  
- **데이터 저장의 중요성:** 사용자의 활동(그림 등)을 저장하고 다시 보여주는 기능은 학습 몰입도를 높이는 데 매우 유용함  
- **버그 해결의 뿌듯함:** 단어 연결 게임의 흐름 문제를 해결하면서 UI/UX 흐름이 더 매끄러워졌고, 사용자 만족도를 높일 수 있었음
- **세부 사항의 중요성:** 그림 그리기와 같은 인터랙티브 기능에서는 세밀한 터치와 사용자 경험이 매우 중요함을 깨달음  
- **리펙토링의 어려움:** 게임 기능들이 랜덤으로 배치되고 다양한 UI 요소가 포함되면서 코드의 길이가 길어지고, 이를 효율적으로 리펙토링하는 것이 큰 도전이었음  
- **실제 사용자 관점:** 기능 구현뿐만 아니라, 사용자 입장에서 자연스럽고 직관적인 인터페이스를 제공하기 위한 고민이 많았음  
- **문제 해결의 지속성:** 아직 미해결된 그림 저장 기능과 단어 연결 정답 판별 로직 등, 해결해야 할 과제가 남아있어 개발자로서 지속적으로 개선해 나가야 함을 느꼈음
- **클라우드 기반 서비스의 장점:** Firebase로 마이그레이션하면서 멀티 디바이스 지원과 데이터 백업 문제가 자연스럽게 해결됨을 경험
- **데이터 구조화의 중요성:** 처음부터 확장성을 고려한 데이터 설계가 얼마나 중요한지 깨달았으며, 구조화된 데이터는 앱 확장 시 큰 자산이 됨
- **ML 모델 통합의 복잡성:** AI 모델 통합 과정이 생각보다 복잡하며, 이미지 데이터 처리와 서버-클라이언트 간 안정적인 통신 설계가 핵심임을 이해함
- **확장성 있는 아키텍처 설계의 가치:** 초기에는 번거롭더라도 확장 가능한 서비스 아키텍처를 설계하는 것이 장기적으로 개발 시간과 리소스를 절약함을 체감
- **다양한 기술 스택의 통합 경험:** Flutter와 Python/Flask를 함께 사용하면서 각 플랫폼의 장단점을 이해하고 효과적으로 결합하는 방법을 습득함
- **API 디버깅의 중요성:** 422 오류를 해결하는 과정에서 API 요청/응답 로깅과 체계적인 디버깅 방법이 얼마나 중요한지 깨달음
- **UX 디테일의 영향력:** 선 굵기를 고정하는 간단한 변경으로 그림 인식률이 크게 향상되어, 작은 UX 디테일이 기능 성능에 큰 영향을 미칠 수 있음을 경험
이어서 마크다운 코드를 제공합니다:
